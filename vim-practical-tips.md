---
title: "実践Vim: 見落としがちだけど強力なVimテクニック集"
emoji: "⚡"
type: "tech"
topics: ["vim", "neovim", "editor", "productivity"]
published: false
---

## はじめに

私とVimの出会いは2007年頃、銀行のシステムのSolaris上でvi を使用してKshellスクリプトを編集したことから始まりました。積極的なモチベーションがあったわけではなく、必要に迫られて覚えたというのが正直なところです。当時はオライリーの『入門vi』を片手に操作を覚えました。

その後はvimtutorを何度かやったり、IntelliJやVSCodeなどのIDEのVimプラグイン、HackMDやObsidianなどのノートツールでVimモードを使う程度。[vimをちょっとだけ使えるようになりたい人へ](https://zenn.dev/vim_jp/articles/0009-just_want_to_be_able_to_use_for_vim_begineer)くらいの操作は大体使えるレベルでした。

そんな「何となくVimを使っている」私が『実践Vim 思考のスピードで編集しよう！』を読んで、見落としていたテクニックをまとめました。本記事では第1部「モード」の内容を中心に扱います。

## 第1章: Vimのやり方

### ドットコマンドの真価

`;` と `.` コマンドの組み合わせを知りました。

```vim
; " カーソルを次の変更対象まで移動
. " 直前の変更を繰り返す
```

`;.` を繰り返すだけで、同じパターンの変更を連続して実行できます。これは「ドットの公式」とも呼ばれ、Vimの哲学の中核をなす考え方です。

### 繰り返し vs 回数指定

> 数を数えるのはめんどうだ。同じ時間を使ってドットコマンドを6回実行するだろう。

回数を数えて `6dd` とするより、`dd` を6回繰り返す方が実践的です。なぜなら：
- 数を数える必要がない
- 途中で間違いに気づいたら止められる
- アンドゥも段階的にできる

TODO:上級者が短いコマンドばかり使うとは限らない

## 第2章: ノーマルモード

### アンドゥの単位を意識する

> 頭の中で「アンドゥできる単位」を考えて抜けるのが好みだ

挿入モードで長文を書き続けるのではなく、論理的な単位でESCを押してノーマルモードに戻ることで、アンドゥが使いやすくなります。

また、挿入モードで矢印キーを使うと自動的にアンドゥの単位が作られるという仕様も覚えておくと便利です。

### 数値の加算・減算

```vim
<C-a> " 数値を1増やす
<C-x> " 数値を1減らす
10<C-a> " 数値を10増やす
```

CSSの値調整など、人によっては使用頻度が高そうです。

### オペレータとテキストオブジェクトの組み合わせ

```vim
daw " 単語を削除（a word）
gUaw " 現在の単語を大文字に変換
```

`gU` は大文字変換オペレータ。オペレータとテキストオブジェクトを組み合わせることで、無限の可能性が生まれます。
TODO 表現がやや大袈裟

## 第3章: 挿入モード

### 挿入ノーマルモード

> 挿入ノーマルモードはノーマルモードの特殊バージョンで、込められる弾丸は1発だけ

```vim
<C-o> " 挿入モードから一時的にノーマルモードコマンドを1つ実行
```

挿入モード中に `<C-o>zz` でカーソル位置を画面中央に移動したり、`<C-o>$` で行末に移動したりできます。

### Expressionレジスタで計算

```vim
<C-r>= " 挿入モードで計算式を入力
```

挿入モード中に `<C-r>=2+2<Enter>` で、計算結果の「4」を直接挿入できます。

## 第4章: ビジュアルモード

### 前回の選択範囲を再選択

```vim
gv " 直前に選択したテキスト範囲を再度選択
```

選択を間違えて解除してしまった時や、同じ範囲に別の操作をしたい時に使えます。

### 選択範囲の始点と終点を入れ替え

```vim
o " ビジュアルモード中に始点と終点を入れ替え
```

範囲選択中に間違った場所から開始したことに気づいた時、これで簡単に修正できます。

### ビジュアルモードの繰り返しの罠

> ビジュアルモードコマンドが繰り返されるときに、それが適用されるのは、同じ範囲のテキストだ

ドットコマンドで繰り返したい操作は、ビジュアルモードではなくオペレータコマンドを使うべきです。例えば、`Vjd` より `dj` の方が繰り返しやすい。

## 第5章: コマンドラインモード

### コピー・移動の便利コマンド

```vim
:t " copyコマンドの短縮形（行をコピー）
:m " moveコマンド（行を移動）

:t. " 現在行を下にコピー
:t$ " 現在行をファイル末尾にコピー
:10,20t0 " 10-20行目をファイル先頭にコピー
```

### Exコマンドの繰り返し

```vim
@: " 直前のExコマンドを繰り返す
```

ドットコマンドはノーマルモードのみ。Exコマンドを繰り返すには `@:` を使います。

### シェルコマンドの出力を挿入

```vim
:read !{cmd} " コマンドの出力を現在のバッファに挿入
:read !date " 現在の日時を挿入
:read !ls " ファイル一覧を挿入
```

## その他の発見

### 表示行の移動

```vim
gj " 表示行を下に移動（折り返された行でも1行ずつ）
gk " 表示行を上に移動
```

長い行が折り返されている時、`j`/`k` は論理行単位で移動しますが、`gj`/`gk` は見た目通りに移動します。

### ジャンプリスト

```vim
<C-o> " ジャンプリストを戻る（ブラウザの戻るボタンのように）
<C-i> " ジャンプリストを進む
```

ファイル間を移動した履歴を辿れます。定義元へジャンプして、また戻ってくるような操作が簡単に。
複数のIDEを使っていると、ショートカットを間違えることがよくありますが、この操作に慣れるとストレスが減ります。

### ヤンクレジスタ

```vim
"0p " ヤンクレジスタ（レジスタ0）から貼り付け
```

`y` でヤンクしたテキストは無名レジスタだけでなく、レジスタ0にも保存されます。`d` や `c` で上書きされないので、ヤンクしたテキストを確実に取り出せます。

### カーソル位置の調整付きペースト

```vim
gp " ペースト後、カーソルを貼り付けたテキストの末尾に移動
gP " 上にペースト後、カーソルを末尾に移動
```

複数行をコピーする時に特に便利です。

## まとめ

Vimは「知っているか知らないか」で差が出るエディタです：

1. **ドットコマンドを活かす編集スタイル**を意識する
2. **オペレータとテキストオブジェクト**の組み合わせを理解する
3. **レジスタとジャンプリスト**を活用する

これらを意識すると、編集効率が向上します。

### 参考

- [実践Vim 思考のスピードで編集しよう！](https://www.amazon.com/dp/B00HWLJI3U) - Drew Neil著、新丈径訳
